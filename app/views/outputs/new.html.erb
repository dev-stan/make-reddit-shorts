<div class="container mt-3 text-white mt-24 px-24 justify-center px-56">
  <div class="row">
    <!-- Flash Messages -->
    <% flash.each do |type, msg| %>
      <div class="alert alert-<%= type %>">
        <%= msg %>
      </div>
    <% end %>
    <%= simple_form_for @output, data: { controller: "output-upload", output_upload_target: "form" } do |f| %>
      <!-- Reddit Post URL & Video Script -->
      <div class="border rounded-3 p-4 mt-3 mb-3 bg-light shadow-sm" data-controller="script-edit">
        <h5>Reddit Post</h5>
        <p class="text-dark">Link to your reddit post, make sure the subreddit is public!</p>
        <%= f.input :reddit_post_url, placeholder: "Enter Reddit post URL", 
                    input_html: {
                      value: params[:query],
                      class: 'form-control border-primary border-2 bg-transparent',
                      data: { script_edit_target: "input", action: "input->script-edit#checkUrl" }
                    } %>
        <h5 class="mt-3">Video Script</h5>
        <p class="text-dark">Enter the script for the video here.</p>
        <%= f.input :script, as: :text,
                    input_html: {
                      data: { script_edit_target: "script", action: "input->script-edit#updateEstimate" },
                      class: 'form-control border-primary border-2 bg-transparent', rows: 10
                    }, error: false %>
        <p data-script-edit-target="estimate">Estimated speech time: 0 seconds</p>
      </div>
      <!-- Video Source Selection -->
      <div class="border rounded-3 p-4 pt-3 mb-3 bg-light shadow-sm" data-controller="video-upload">
        <h5>Background Video</h5>
        <p class="text-dark">The video of your choice will be played in the background.</p>
        <h4>Select a Source:</h4>
        <div class="d-flex gap-3">
          <%= f.collection_radio_buttons :source_id, @sources, :id, :to_s do |b| %>
            <div class="form-check">
              <%= b.radio_button(class: "form-check-input visually-hidden") %>
              <img src="/home_gif.gif" alt="" class="rounded-3 shadow-sm image-container">
            </div>
          <% end %>
        </div>
      </div>
      <!-- Subtitle Presets -->
      <div class="border rounded-3 p-4 mt-3 mb-3 bg-light shadow-sm">
        <h5>Subtitle Presets</h5>
        <p class="text-dark">Choose a style from one of our presets.</p>
        <%= f.input :subtitle_preset, as: :hidden %> <!-- Hidden input -->
        <div class="d-flex gap-3 justify-content-center">
          <% [['Vanilla', 'Vanilla'], ['Yellow', 'Yellow'], ['Red', 'Red']].each do |value, label| %>
            <label class="form-check" style="cursor: pointer;">
              <%= f.radio_button :subtitle_preset, value, class: 'form-check-input visually-hidden' %>
              <img src="/text_sample.png" alt="<%= label %>" class="rounded-3 shadow-sm image-sample">
            </label>
          <% end %>
        </div>
      </div>
      <!-- Voice Settings -->
      <div class="border rounded-3 p-4 mt-3 mb-3 bg-light shadow-sm" data-controller="voice-speed">
        <h5>Voice Settings</h5>
        <p class="text-dark">Choose a voice style from our presets.</p>
        <div class="d-flex flex-wrap justify-content-between">
          <% options = [['Amy', 'Amy'], ['Matthew', 'Matthew'], ['Ruth', 'Ruth']] %>
          <% options.each_with_index do |(value, label), index| %>
            <div class="form-check flex-fill mb-2">
              <!-- Hidden radio input field -->
              <%= f.radio_button :voice_preset, value, class: 'd-none', id: "voice_preset_#{index}" %>
              <%= f.label :voice_preset, label, class: "btn btn-outline-primary voice-button w-100 text-center #{'active' if f.object.voice_preset == value}", for: "voice_preset_#{index}" %>
            </div>
          <% end %>
        </div>
        <!-- Hidden input to store selected voice preset -->
        <%= f.hidden_field :voice_preset, id: "voice-preset-hidden" %>
      </div>
      <!-- Voice Speed Slider -->
      <div class="mt-4">
        <h5 class="mt-4">Voice Speed</h5>
        <p class="text-dark">Set the voice speed (50 to 150): <span id="speed-value">100</span></p>
        <input type="range" min="50" max="150" value="100" id="voice-speed-slider" 
           class="form-range" data-action="input->voice-speed#updateSpeed">
        <!-- Hidden input to store the selected value and submit it with the form -->
        <%= f.hidden_field :voice_speed, value: 100, id: "voice-speed-hidden" %>
      </div>
      <!-- Submit Button -->
      <div class="p-4">
        <%= f.button :submit, "Generate", data: { action: "click->output-upload#submit" }, class: 'btn btn-primary' %>
      </div>
    </div>
  <% end %>
</div>
<!-- Simplified CSS -->
<style>
  .form-check {
    display: flex;
  }
  .form-check-input {
    margin-right: 0.5rem;
  }
  .visually-hidden {
    position: absolute;
    left: -9999px;
  }
  .image-container, .image-sample {
    object-fit: cover;
    width: 100px;
    height: auto;
    transition: outline 0.3s ease;
  }
  .form-check input:checked + img {
    outline: 3px solid #007bff;
  }
  .voice-button {
    flex: 1;
    display: inline-block;
    text-align: center;
  }
  .btn-secondary {
    background-color: #6c757d;
    border-color: #6c757d;
  }
</style>
<!-- JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const speedSlider = document.getElementById("voice-speed-slider");
    const speedValueDisplay = document.getElementById("speed-value");
    const hiddenSpeedInput = document.getElementById("voice-speed-hidden");
    const voiceButtons = document.querySelectorAll(".voice-button");
    const hiddenVoiceInput = document.getElementById("voice-preset-hidden");

    // Update the displayed value and hidden field when the slider changes
    speedSlider.addEventListener("input", function() {
      const currentSpeed = speedSlider.value;
      speedValueDisplay.textContent = currentSpeed; // Display the selected speed
      hiddenSpeedInput.value = currentSpeed; // Set hidden input value to the slider value
    });

    // Handle voice button selection
    voiceButtons.forEach(button => {
      button.addEventListener("click", function() {
        voiceButtons.forEach(btn => btn.classList.remove("active"));
        button.classList.add("active");
        hiddenVoiceInput.value = button.textContent.trim();
      });
    });
  });
</script>
